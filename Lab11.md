# Lab 11 Final Embedded System

## Table of Contents

- [Lab 11 Final Embedded System](#lab-11-final-embedded-system)
  - [Table of Contents](#table-of-contents)
  - [0 Repository Structure](#0-repository-structure)
    - [0.1 HW](#01-hw)
    - [0.2 SW](#02-sw)
    - [0.3 Resources](#03-resources)
    - [0.4 Git and Github](#04-git-and-github)
  - [1 Summary](#1-summary)
    - [1.1 Goals](#11-goals)
    - [1.2 Team Size](#12-team-size)
    - [1.3 Review](#13-review)
    - [1.4 Starter Files](#14-starter-files)
    - [1.5 Background](#15-background)
  - [2 Preparation](#2-preparation)
  - [3 Procedure](#3-procedure)
    - [3.1 Bringing Up a TM4C123 LaunchPad System](#31-bringing-up-a-tm4c123-launchpad-system)
    - [3.2 Bringing Up an SMD TM4C123 System](#32-bringing-up-an-smd-tm4c123-system)
    - [3.3 Programming the SMD Chip](#33-programming-the-smd-chip)
  - [4 Checkout](#4-checkout)
  - [5 Report](#5-report)
    - [5.1 Deliverables](#51-deliverables)
    - [5.2 Analysis and Discussion Questions](#52-analysis-and-discussion-questions)
  - [6 Grading](#6-grading)

---

## 0 Repository Structure

The typical explanation for the repo structure. Lab specific instructions can be
found further below.

### 0.1 HW

The `hw` folder should contain your schematic and board files for your PCB or
circuits. In labs 1-5 and 10, you will be creating schematics for your circuit
in EAGLE. A setup tutorial can be found
[here](https://www.shawnvictor.net/autodesk-eagle.html).

### 0.2 SW

The `sw` folder should contain your application firmware and software written
for the lab. The `sw/inc` folder contains firmware drivers written for you by
Professor Valvano. Feel free to write your own (in fact, in some labs, you may
be required to write your own).

You can place any other source files in the `sw` folder. TAs will look at the
files you create and/or modify for software quality and for running your
project.

### 0.3 Resources

A couple files are provided in the Resources folder so you don't have to keep
searching for that one TI document. Some of them are immediately useful, like
the TM4C datasheet. Others may be useful for your final project, like the
TM4C_System_Design_Guidelines page.

### 0.4 Git and Github

We will extensively use Git and Github for managing lab projects. This makes it
easier for TAs to grade and help debug the project by allowing us to see commit
histories, maintain a common project structure, and likewise, it makes it easier
for students to collaborate with partners, merge different codebases, and to
debug their work by having a history of commits.

Two common ways of using Git and Github are [Github Desktop](https://desktop.github.com/) and the [command line](https://git-scm.com/downloads).
[Tutorials](https://dev.to/mollynem/git-github--workflow-fundamentals-5496) are also abundant on the net for you to peruse. We've provided a cheatsheet for git
in the Resources folder.

It is highly recommended to make the most out of Git, even if you've never used
it before. Version control will save you a lot of suffering, and tools like Git
or SVN are ubiquitous in the industry.

A gitignore file is added to the root of this repo that may prevent specific
files from being tagged to the repo. This are typically autogenerated output
files we don't care about, but sometimes other stuff (like .lib files) falls
through that we want. Feel free to modify if necessary.

---

## 1 Summary

### 1.1 Goals

1. Build and test an embedded system

### 1.2 Team Size

The team size is 4

> "Fourgive me father four I have sinned."

### 1.3 Review

1. None

### 1.4 Starter Files

1. None

### 1.5 Background

You will complete the embedded system you began in Lab 7. This lab includes hardware construction, software debugging and system evaluation. There will be a “Science Fair”-like public demonstration for Lab 11. I will present special awards to the team of four with the best design. The preliminary round will be judged by your TA during your lab session, and the final round will be judged by other students and observers.

---

## 2 Preparation

1. Write the main high-level application that implements the final objective of the embedded system. If you want to change what your system does, please get approval from your TA.
2. Add more detail to the **requirements document** that was created in Lab 7. In particular, give more detail about how the system will be evaluated. Increase the length from one page to two pages.
3. Gather all the parts needed to build the system. Update the bill of materials (BOM).
4. Solder all parts needed to flash code to the board.

---

## 3 Procedure

*Note: you should be constantly checking to ensure there are no shorts in your system*

*Note: I (Jared) would recommend soldering all SMD components before soldering through-hole components so that components do not hinder your ability to reach the SMD pads*

*Note: think about how your system will fit together mechanically before soldering*

### 3.1 Bringing Up a TM4C123 LaunchPad System

1. Verify there are no shorts between +3.3V power, ground, battery input, or 5V power line (use a multimeter's continuity test mode)
2. Clean the pads with isopropyl alcohol
4. Solder the +3.3V, +5V, battery, and ground test points
5. Solder power components:
   1. Verify there are no shorts between +3.3V power, ground, battery input, or 5V power line (use a multimeter's continuity test mode)
   2. Solder the power input connectors, on-off switch, regulator(s), and regulator capacitors
   3. Measure the current drawn across the input power (should be small without any load)
   4. Measure all supply voltages (input and output of voltage regulator(s)) to verify they are correct
6. Solder LaunchPad components:
   1. Verify there are no shorts between +3.3V power, ground, battery input, or 5V power line (use a multimeter's continuity test mode)
   2. Solder LaunchPad header connectors and any other parts absolutely necessary to connect the TM4C123 LaunchPad to the system
   3. Measure the current drawn across the input power (should be 20mA to 40mA with the TM4C123 LaunchPad)
   4. Measure all supply voltages (input and output of voltage regulator(s)) to verify they are correct
7. Solder debugging components:
    1. Verify there are no shorts between +3.3V power, ground, battery input, or 5V power line (use a multimeter's continuity test mode)
    2. Solder debugging components (test-points, logic analyzer headers, power supply and heartbeat LEDs, etc.)
    3. Run TM4C code to test the debugging components
8. Solder additional components:
   1. Verify there are no shorts between +3.3V power, ground, battery input, or 5V power line (use a multimeter's continuity test mode)
   2. Solder components by submodules and height (lower components come before higher components)
   3. The idea is to solder a functionally complete submodule and test it so that you can determine which submodule has an error
   4. Record the current required to run the entire system each time you test it
   5. 3 or 4 current measurements for this part are expected in your lab report
9. Debug the embedded system using hardware/software debugging skills as appropriate

### 3.2 Bringing Up an SMD TM4C123 System

1.  Verify there are no shorts between +3.3V power, ground, battery input, or 5V power line (use a multimeter's continuity test mode)
2.  Clean the pads with isopropyl alcohol
3.  Align the TM4C123 on the board
4.  Apply solder flux to the pin
5.  Align the TM4C123 on the board
6.  Gently touch the solder iron
7.  Solder one pin
8.  Align the TM4C123 on the board
9.  Solder a second pin
10. Solder the rest of the 48 pins
11. Verify there are no shorts between +3.3V power, ground, battery input, or 5V power line (use a multimeter's continuity test mode)
12. Check for shorts between adjacent pins on the processor (use a multimeter's continuity test mode)
    1.  Use thin wire (28 or 30 gauge) to touch the multimeter's probes to the processor's pins
    2.  Remove excessive solder with a solder wick
    3.  If adjacent pins are connected but you see no solder, gently cut between processor pins with a sharp knife
13. Solder the crystal and all the caps around the processor
    1. Make sure crystal capacitors are 10pF ceramic X7R
14. Solder and test the power components
    1.  Verify there are no shorts between +3.3V power, ground, battery input, or 5V power line (use a multimeter's continuity test mode)
    2.  Solder the 1MΩ resistor attached to **WAKE**
    3.  Solder the 3.3V and ground test points
15. Test the oscillator circuit
    1.  Verify there are no shorts between +3.3V power, ground, battery input, or 5V power line (use a multimeter's continuity test mode)
    2.  Set the bench power supply to 3.3V with a current limit of 100mA
    3.  Attach the bench power supply to the 3.3V power rails by connecting to the 3.3V and ground test points
    4.  Observe the 16MHz wave on both crystal pins
16. Solder and test the regulator circuit(s)
    1.  Test the regulator circuits on a breadboard to verify that they work correctly
    2.  Solder the regulator circuit(s)
    3.  Connect voltmeter(s) to the regulated power line(s) 3.3V and 5V if applicable
    4.  Use a bench supply and limit the current to 50mA
    5.  Apply power to the TM4C123 and remove immediately if 3.3V is not measured
    6.  Record the current required to run just the processor
    7.  Observe the 16MHz wave on both crystal pins
17. Test the board with the Flash programmer:
    1.  Follow the steps in [Programming the SMD Chip](#programming-the-smd-chip) to connect the board's TM4C123 to a LaunchPad's debug chip
    2.  Attach a voltmeter to the 3.3V pin on the board
    3.  Remove power immediately if the voltmeter does not read 3.3V
    4.  Download, install, and run the Flash programmer as specified in the [pdf](http://users.ece.utexas.edu/~valvano/EE345L/Labs/Fall2011/Ifyoumessuptheboard.pdf)
18. Test the board with a simple program:
    1.  Follow the steps in [Programming the SMD Chip](#programming-the-smd-chip) to connect the board's TM4C123 to a LaunchPad's debug chip
    2.  Attach a voltmeter to the 3.3V pin on the board
    3.  Remove power immediately if the voltmeter does not read 3.3V
    4.  Download the [SimpleProject_4C123asm project](http://users.ece.utexas.edu/%7Evalvano/arm/SimpleProject_4C123asm.zip) to the TM4C123
    5.  Run the Keil debugger
19. Solder additional components:
    1.  Verify there are no shorts between +3.3V power, ground, battery input, or 5V power line (use a multimeter's continuity test mode)
    2.  Solder components by submodules and height (lower components come before higher components)
    3.  The idea is to solder a functionally complete submodule and test it so that you can determine which submodule has an error
    4.  Record the current required to run the entire system each time you test it
    5.  3 or 4 current measurements for this part are expected in your lab report
20. Debug the embedded system using hardware/software debugging skills as appropriate

### 3.3 Programming the SMD Chip

1. Remove power
2. Remove the 2-pin jumper from a LaunchPad (disconnects power from the target TM4C123 leaving just the debugger TM4C123)
3. Solder/connect the following 5 wires between your target and the LaunchPad:
   1. GND to GND
   2. TCLK to SCLK
   3. TDO to TDO
   4. TDI to TDI
4. Apply separate power to both the LaunchPad and the target PCB
5. Use the Keil debugger as usual
6. Disconnect the 5 wires when done

---

## 4 Checkout

Demonstrate the operation of the embedded system. Be prepared to discuss any difficulties or challenges you had in implementing the embedded system. You will also need to describe your testing procedure.

---

## 5 Report

### 5.1 Deliverables

1. Objectives
   1. 2-page requirements document
2. Hardware Design
   1. Detailed circuit diagram of the system (from Lab 7)
   2. If a bug resulted in anything being changed in the schematic, implement those changes within the schematic
3. Software Design
   1. Briefly explain how your software works (1/2 maximum)
4. Measurement Data
   1. Include data as appropriate for your system
   2. Explain how the data was collected

### 5.2 Analysis and Discussion Questions

None

---

## 6 Grading

| Section                                       | Description                                   | Points    |
|-----------------------------------------------|-----------------------------------------------|-----------|
| Preparation: High Level Application           | Graded on completeness rather than style      | 10        |
| Preparation: BOM and Parts                    | Complete BOM and all parts in possession      | 5         |
| Preparation: Requirements Document            | 2-page requirements document                  | 5         |
| Checkout: Project                             | Project demonstration and quality of design   | 25        |
| Checkout: Testing                             | Description of how the system was tested      | 5         |
| Software Quality: Modularity and Organization | N/A                                           | 10        |
| Software Quality: Readability                 | N/A                                           | 10        |
| Software Quality: Functionality               | N/A                                           | 10        |
| Report                                        | Testing procedure and testing data            | 20        |